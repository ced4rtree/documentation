
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Robot%20Names/">
      
      
        <link rel="next" href="../../Programming/Device%20Health%20Manager/">
      
      
        
      
      
      <link rel="icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Swerve Tuning - Tator Tome</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#step-1-put-the-robot-on-blocks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Tator Tome" class="md-header__button md-logo" aria-label="Tator Tome" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tator Tome
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Swerve Tuning
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Tator Tome" class="md-nav__button md-logo" aria-label="Tator Tome" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Tator Tome
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Miscellaneous
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Miscellaneous
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Drive%20Practice%20Setup%20for%20Mechanical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Drive Practice Setup for Mechanical Students
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Making%20a%20Backup%20SD%20Card%20at%20a%20Competition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Making an SD Card Backup at a Competition
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Robot%20Names/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Robot Names
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Swerve Tuning
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Swerve Tuning
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-put-the-robot-on-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Put the robot on blocks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-align-the-azimuths" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Align the Azimuths
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-drive-motor-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Drive Motor Tuning
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-azimuth-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Azimuth Tuning
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Programming
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Programming
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Programming/Device%20Health%20Manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Device Health Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Programming/RepulsorFieldPlanner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Repulsor Field Planner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-put-the-robot-on-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Put the robot on blocks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-align-the-azimuths" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Align the Azimuths
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-drive-motor-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Drive Motor Tuning
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-azimuth-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Azimuth Tuning
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Swerve Tuning</h1>

<p>Swerve wheels consist of two parts: the <strong>azimuth</strong> controls where the wheel points, while the <strong>drive</strong> actually runs the wheels. Both parts need to be well-tuned for a robot to drive well (though it's not hard to get azimuth well-tuned).</p>
<h2 id="step-1-put-the-robot-on-blocks">Step 1: Put the robot on blocks</h2>
<p>For tuning the azimuths, the robot needs to be off the ground. Get some blocks (there's a bin with plastic blocks of various shapes somewhere in the shop that works nicely, other kinds of blocks will also work) and use them to get the robot off the ground. Make sure the wheels won't hit or grip anything when rotating + driving.</p>
<h2 id="step-2-align-the-azimuths">Step 2: Align the Azimuths</h2>
<p>The azimuths need to be tuned such that, if the drive motors are driving in a <em>positive</em> direction and the azimuth motors are at an angle of <strong>0</strong>, the robot should drive forwards.  </p>
<p>Before tuning, we want to deploy Phoenix's <strong>temporary diagnostic server</strong>. It will do absolutely nothing, which is great when you don't want the motors to move while you're tuning them.</p>
<ol>
<li>If there isn't any robot code, Phoenix will readily offer to deploy the diagnostic server in the Devices menu. Click the RUN TEMPORARY DIAGNOSTICS button.  </li>
</ol>
<p><img src="../../images/PhoenixTunerX-RunTempDiag-DevicesMenu.png" style="height: 6em"></p>
<ol>
<li>If there is other robot code, or if the button otherwise dosen't show up, go to the Settings menu from the hamburger menu in the upper left.</li>
<li>Expand the "FRC Advanced" section and click "Run Temporary Diagnostic Server".</li>
</ol>
<p>After the temporary diagnostic server is running, do the following for each wheel:</p>
<ol>
<li>Find the Cancoder for that wheel in Phoenix Tuner X. Make sure you've got the right one by using the Blink button.</li>
<li>Go into the <strong>Config</strong> tab and set the Magnet Offset to 0. Use the "Apply and flash configs" button (<img src="../../images/PhoenixTunerX-FlashConfigButton.png" style="height: 1em" title="It looks like it's downloading something onto a motor">) to save the config.</li>
<li>Turn the wheel so that it's aligned forward-backward (don't worry about if it's inverted yet). The shop has a swerve alignment tool; use it if possible.</li>
<li>Go to the <strong>Self Test</strong> tab and click Refresh; this should load a page. Copy the Absolute Position value (only the number), flip the sign (positive to negative and vice versa), and paste it into the Magnet Offset field in the config.</li>
<li>Flash the config. Make sure the offset is correct by refreshing the Self Test and checking that the Absolute Position is now near-zero (within Â±0.01 is good).</li>
<li>Find the drive motor for the current wheel.</li>
<li>Go to the Control panel and set the control mode to VoltageOut (below the big red DISABLED button), and set the Output to a very small value (just below 0.5V is good).</li>
<li>Enable the robot in Test mode.</li>
<li>Click the DISABLED button to enable Phoenix control and run the wheel. If the wheel would push the robot forward (it would push the ground backwards), great! Disable the motor control and skip this step. If not:<ol>
<li>Disable motor control, then go back to the Cancoder and go to the Config tab.</li>
<li>If the magnet offset is negative, add 0.5, else subtract 0.5. Flash the config.</li>
</ol>
</li>
<li>Make sure to save the magnet offset in code if it's saved there.</li>
<li>Swerve wheels are generally not perfectly symmetrical. Check for something that's on one side of the wheel only, and use that information to get the wheel angle right the first time for the rest of the wheels.</li>
</ol>
<p>After tuning all the azimuths, verify by going either into Manual Tests and using the <code>SwerveTuningTest</code> to drive the wheels, or going into Teleop and just driving in that mode.</p>
<h2 id="step-3-drive-motor-tuning">Step 3: Drive Motor Tuning</h2>
<p>Tuning the drive motors ensures that the bot drives at the correct speed.</p>
<ol>
<li>Get the bot off blocks and on the ground. The tuning will be very different if the wheels aren't pushing a bot.</li>
<li>Make sure that the <code>SwerveTuningTest</code> manual test is available in the swerve subsystem.</li>
<li>Go into Test mode and select the <code>SwerveTuningTest</code> test.</li>
<li>Open up Shuffleboard or similar tool, and look under the <code>quick/SwerveTuning</code> path for <a href="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/introduction/index.html">PID values</a>.</li>
<li>First, tune <strong>S</strong>.<ol>
<li>Start it at a small guess value (e.g. 0.5V).</li>
<li>Increase S if the bot doesn't move, decrease S if it does.</li>
<li>Repeat until S is just barely <em>not</em> enough to move the robot.</li>
</ol>
</li>
<li>Next, tune <strong>V</strong>.<ol>
<li>You'll need to look at the <code>DesiredSpeed</code> and <code>ActualSpeed</code> values under the <code>quick/SwerveTuning</code> table, preferrably as a graph; open AdvantageScope, connect to the robot (Ctrl-K), and put those two values into a graph.</li>
<li>Start V at a small guess value (0.01).</li>
<li>Increase V if the bot goes too slow, decrease V if it's too fast. Make sure to test moving around as well as rotating.</li>
<li>Repeat until the bot drives <em>roughly</em> the speed it's being told to. Don't worry about getting this extremely accurate; that's what P and D are for.</li>
</ol>
</li>
<li>Now, tune <strong>P</strong>.<ol>
<li>Find some sort of weight to add to the robot, e.g. a stack of cones. Place it on the robot.</li>
<li>Start P at the same value as V.</li>
<li>Increase to increase snappiness, decrease if the wheels make scary noises due to jittering. Make sure to test moving around as well as rotating.</li>
<li>Repeat until it's low enough to consistently avoid scary noises.</li>
<li>Test that the robot still moves well with the weight removed.</li>
</ol>
</li>
<li>Finally, tune <strong>D</strong>.<ol>
<li>TODO figure out how to use D properly; it seems to just make the wheels jitter when I try to use it. (For future refrence I started it at 1/100th and it instantly caused jitter.)</li>
</ol>
</li>
<li>Remeber to save P/D/S/V values to code.</li>
</ol>
<h2 id="step-4-azimuth-tuning">Step 4: Azimuth Tuning</h2>
<p>The azimuth motors are usually just so overpowered that it's very easy to get it very close. If the azimuths don't appear to be poorly tuned, you probably don't need to retune them.</p>
<ol>
<li>Go back into that <code>SwerveTuningTest</code> test and hit Back/Select to swap to azimuth mode.</li>
<li>Replace the P/D/S/V values with the ones currently in code for the azimuths. (which probably just has P set.)</li>
<li>If the azimuths aren't turning very fast, increase P. If they're going crazy, decrease P.</li>
<li>Repeat until it gets to its setpoint fairly quickly (say, under 0.3s)</li>
<li>Remeber to save P/D/S/V values to code.</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.select"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>