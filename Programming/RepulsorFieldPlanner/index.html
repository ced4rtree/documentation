
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Device%20Health%20Manager/">
      
      
      
        
      
      
      <link rel="icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Repulsor Field Planner - Tator Tome</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#repulsor-field-planner-or-obstacle-avoidance-via-vector-field" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Tator Tome" class="md-header__button md-logo" aria-label="Tator Tome" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tator Tome
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Repulsor Field Planner
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Tator Tome" class="md-nav__button md-logo" aria-label="Tator Tome" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Tator Tome
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Miscellaneous
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Miscellaneous
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Miscellaneous/Drive%20Practice%20Setup%20for%20Mechanical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Drive Practice Setup for Mechanical Students
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Miscellaneous/Making%20a%20Backup%20SD%20Card%20at%20a%20Competition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Making an SD Card Backup at a Competition
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Miscellaneous/Robot%20Names/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Robot Names
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Miscellaneous/Swerve%20Tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Swerve Tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Programming
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Programming
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Device%20Health%20Manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Device Health Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Repulsor Field Planner
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Repulsor Field Planner
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-repulsorfieldplannerjava" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is RepulsorFieldPlanner.java?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-does-repulsorfieldplannerjava-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Does RepulsorFieldPlanner.java Work?
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How Does RepulsorFieldPlanner.java Work?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#intro-to-vector-fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intro to Vector Fields
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visualization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Final Algorithm
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-do-i-use-repulsorfieldplannerjava" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Do I Use RepulsorFieldPlanner.java?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adapting-from-year-to-year" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adapting From Year to Year
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-repulsorfieldplannerjava" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is RepulsorFieldPlanner.java?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-does-repulsorfieldplannerjava-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Does RepulsorFieldPlanner.java Work?
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How Does RepulsorFieldPlanner.java Work?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#intro-to-vector-fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intro to Vector Fields
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visualization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Final Algorithm
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-do-i-use-repulsorfieldplannerjava" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Do I Use RepulsorFieldPlanner.java?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adapting-from-year-to-year" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adapting From Year to Year
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="repulsor-field-planner-or-obstacle-avoidance-via-vector-field">Repulsor Field Planner or: Obstacle Avoidance via Vector Field</h1>
<h2 id="introduction">Introduction</h2>
<p><code>RepulsorFieldPlanner.java</code> is a file used in the codebase of a robot that
calculates what direction to go in order to reach a goal on the field, given the
fact that there are obstacles in the way. A lot of the math may seem
unapproachable or overwhelming at first, but so long as you're willing to put
some effort into reading this document and learning some things, I'm sure you'll
see it's not too bad.</p>
<p>This document is designed to help a student, whether rookie or veteran,
mathematically inclined or averse, understand what <code>RepulsorFieldPlanner.java</code>
is meant to solve, how it solves that problem, and how to use it. Please be
inclined to ask questions to mentors or other students should you have any
questions or confusions. The team is here to help you, and so is this document.</p>
<h2 id="what-is-repulsorfieldplannerjava">What is <code>RepulsorFieldPlanner.java</code>?</h2>
<p>Originally designed during the 2025 competition season, the file arose from the
wider FRC community, not specifically from Team Tators. In particular, the
original derivation (<a href="https://github.com/icrobotics-team167/2025_Reefscape/blob/main/src/main/java/frc/cotc/drive/RepulsorFieldPlanner.java">which can be found
here</a>)
used in our codebase comes from Children of the Corn, team #167. This document,
however, is unique to our team. In 2025, there was a large hexagonal obstacle in
the middle of each alliance's side of the field that the robot had to place on,
and it was soon realized that automating the entire placement process (i.e. the
robot takes control of driving the moment a gamepiece was picked) would be a lot
faster than the standard manual driving approach employed in years past.
However, the easy way of driving in a straight line from point A to point B
wouldn't quite cut it, since, as mentioned previously, there was a large
hexagonal obstacle in the way. Thus, obstacle avoidance was born.</p>
<h2 id="how-does-repulsorfieldplannerjava-work">How Does <code>RepulsorFieldPlanner.java</code> Work?</h2>
<p>But how does one avoid obstacles? It's a somewhat difficult problem to think
about, really. In the past, the typical approach to driving to a point, not
considering obstacles, was to just use a simple PID control loop on your robot's
position to drive it to a specific point. The new idea amongst the community was
to define something called a <a href="https://math.libretexts.org/Bookshelves/Calculus/Calculus_(OpenStax)/16%3A_Vector_Calculus/16.01%3A_Vector_Fields">vector
field</a>
to represent the field.</p>
<h3 id="intro-to-vector-fields">Intro to Vector Fields</h3>
<p>If you're somebody who has not taken calculus yet, then that link leading to a
calculus textbook may seem scary. If you want to continue learning and
improving, you need to eviscerate that thought and eject it far from your
soul. I've been there, and I can tell you the thought of "this math is too
complicated" is not true. A vector field is literally just a bunch of arrows
that point somewhere. Some arrows are longer than others, and so they're
stronger than the other arrows, and whatever thing is there will experience a
greater force in that direction. Why this is considered high level math is
beyond me.</p>
<p>Vector fields are used widely in mathematics and physics, such as when modelling
a gravitational or magnetic field, but they are conceptually easy to
understand. If you've taken AP Calculus, you might be familiar with a slope
field, which is close to what a vector field is. Slope fields define the
direction for a function to travel, while a vector field defines the direction
and strength with which to follow, as vectors have direction and magnitude.</p>
<p>For example, look at the following gif, and glance upon the many arrows drawn in
the hurricane. Now imagine you're something in that hurricane. Pick a point and
try following its path with your finger. Pay attention to the speed and
direction of your movement, and see how it matches up with the length and
direction of the arrows near your finger. This is the same way the robot follows
the vector fields defined in <code>RepulsorFieldPlanner.java</code>.</p>
<p><img src="../../images/hurricane-vector.gif" title="A hurricane with a changing vector field drawn on top of it"></p>
<p>Keep in mind that, although vector fields are often visualized with grids of
arrows whose positions are fixed, a vector field is typically a
<ins>continuous</ins> function, and the grid of arrows is simply an easy way to
visualize a function <span class="arithmatex">\(\vec{F}(x, y)\)</span>, where <span class="arithmatex">\(\vec{F}\)</span> is a vector with
direction and magnitude in a two dimensional plane. The visual grid of arrows is
not a literal definition of a vector field, but more just a helpful way to
visualize many outputs of a continuous function.</p>
<h3 id="visualization">Visualization</h3>
<p>To visualize the vector field you're creating, there's a function in
<code>RepulsorFieldPlanner.java</code> called <code>getArrows()</code>, which returns an array of
<code>Pose2d</code>s. When logged properly (this logging should only happen in simulation,
as the computation is somewhat expensive), the array can be visualized in
<a href="https://docs.advantagescope.org/">AdvantageScope</a>'s odometry or 3D field
tab. For reasons explained below, there are three different types of vector
fields one can draw: goal, obstacle, and sum. The <code>VectorField</code> enum can be
passed into <code>getArrows</code> to determine which field to visualize.</p>
<p>Another point of note is that, due to technical limitations in
<a href="https://docs.advantagescope.org/">AdvantageScope</a>, the strength of vectors
cannot be visualized. Only <code>Pose2d</code>s have translational and rotational data that
can be visualized, but a <code>Pose2d</code> is meant to depict a point, not a vector, and
thus has no way to configure the strength of the vector depicted by one.</p>
<h3 id="final-algorithm">Final Algorithm</h3>
<p>There are really two vector fields at play here. There is a vector field that
points away from obstacles, and there is a vector field that points toward the
goal. They use an inverse square (<span class="arithmatex">\(\vec{F} \propto \frac{1}{x^2}\)</span>) and
proportional strength (<span class="arithmatex">\(\vec{F} \propto x\)</span>) relationship, respectively. Thus,
the closer to an obstacle the robot is, the harder it will drive away, and the
closer the robot is to the goal, the less it will drive towards it.</p>
<p>The final vector is computed by simply adding the resultant vector from each
field together, like so:</p>
<ol>
<li>Compute the vector from field obstacle vector field</li>
<li>Compute the vector from goal position vector field</li>
<li>Add these two vectors together</li>
</ol>
<p>The final step produces a vector that both drives the robot away from obstacles
and drives toward a goal. Step 1 is represented by the function
<code>getObstacleForce()</code>, step 2 by <code>getGoalForce()</code>, and step 3 by <code>getForce()</code> in
the code. It really is that simple.</p>
<h2 id="how-do-i-use-repulsorfieldplannerjava">How Do I Use <code>RepulsorFieldPlanner.java</code>?</h2>
<p>A few things have to happen before one can avoid obstacles. First, create a
repulsor where you plan on using one (typically just within the drive subsystem).</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">RepulsorFieldPlanner</span><span class="w"> </span><span class="n">repulsor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RepulsorFieldPlanner</span><span class="p">();</span>
</span></code></pre></div>
<p>Next, when you want to declare where to travel to, you must tell the repulsor
where that is.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1">// `goal` here is a Pose2d that is assumed to be already known</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">repulsor</span><span class="p">.</span><span class="na">setGoal</span><span class="p">(</span><span class="n">goal</span><span class="p">.</span><span class="na">getTranslation</span><span class="p">());</span>
</span></code></pre></div>
<p>Finally, the repulsor has to be periodically sampled, since the robot is
constantly moving throughout the vector field, changing the vector
calculated. <code>sampleField</code> is a function that will return a <code>RepulsorSample</code>,
which is a custom data type that does nothing more than hold three values:
<code>intermediateGoal</code>, <code>vx</code>, and <code>vy</code>. <code>vx</code> and <code>vy</code> can be used as feedforward
values for the robot velocity, and <code>intermediateGoal</code> can be used in a feedback
loop to compute a more accurate following of the vector field. If you do not
know what "feedforward" or "feedback" are, please refer to <a href="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/introduction/control-system-basics.html#block-diagrams">this useful page on
control theory in the WPILib
documentation</a>
(the provided link points to block diagrams, as that's where feedforward (or
"open-loop") and feedback ("closed-loop") are diagrammed, but the entire page is
worth a read)</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="cm">/* this entire snippet should be called periodically */</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">Pose2d</span><span class="w"> </span><span class="n">pose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPose</span><span class="p">();</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="n">RepulsorSample</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repulsor</span><span class="p">.</span><span class="na">sampleField</span><span class="p">(</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="n">pose</span><span class="p">.</span><span class="na">getTranslation</span><span class="p">(),</span><span class="w"> </span><span class="c1">// translational position of the robot</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="mf">3.5</span><span class="p">,</span><span class="w"> </span><span class="c1">// max speed of the robot in meters per second when following the vector field</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="mf">0.8</span><span class="w"> </span><span class="c1">// distance of the robot in meters from the goal before linearly interpolating a slowdown to 0 m/s</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="p">);</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="n">ChassisSpeeds</span><span class="w"> </span><span class="n">feedforward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ChassisSpeeds</span><span class="p">(</span><span class="n">sample</span><span class="p">.</span><span class="na">vx</span><span class="p">(),</span><span class="w"> </span><span class="n">sample</span><span class="p">.</span><span class="na">vy</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="n">ChassisSpeeds</span><span class="w"> </span><span class="n">feedback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ChassisSpeeds</span><span class="p">(</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="n">transController</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">        </span><span class="n">pose</span><span class="p">.</span><span class="na">getTranslation</span><span class="p">().</span><span class="na">getX</span><span class="p">(),</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">        </span><span class="n">sample</span><span class="p">.</span><span class="na">intermediateGoal</span><span class="p">().</span><span class="na">getX</span><span class="p">()),</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">    </span><span class="n">transController</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">        </span><span class="n">pose</span><span class="p">.</span><span class="na">getTranslation</span><span class="p">().</span><span class="na">getY</span><span class="p">(),</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">        </span><span class="n">sample</span><span class="p">.</span><span class="na">intermediateGoal</span><span class="p">().</span><span class="na">getY</span><span class="p">()),</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">    </span><span class="n">rotController</span><span class="p">.</span><span class="na">calculate</span><span class="p">(</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">        </span><span class="n">pose</span><span class="p">.</span><span class="na">getTranslation</span><span class="p">().</span><span class="na">getRotation</span><span class="p">().</span><span class="na">getRadians</span><span class="p">(),</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">        </span><span class="n">goal</span><span class="p">.</span><span class="na">getRotation</span><span class="p">().</span><span class="na">getRadians</span><span class="p">())</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="p">);</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="n">ChassisSpeeds</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">feedforward</span><span class="p">.</span><span class="na">plus</span><span class="p">(</span><span class="n">feedback</span><span class="p">);</span>
</span></code></pre></div>
<p>And then, if you actually use the <code>output</code> object, you will have obstacle
avoidance. It wasn't that hard, right?</p>
<h2 id="adapting-from-year-to-year">Adapting From Year to Year</h2>
<p><code>RepulsorFieldPlanner.java</code> has many different obstacle types defined in it, but
you may need to formulate more depending on the field. For example,
<code>TeardropObstacle</code> is a pretty unique shape (sort of like "c&gt;", like a
raindrop), but forces the robot to move to the sides of a circular obstacle
should the goal be on the opposite end of the obstacle from the robot. This was
used to model the reef in the 2025 onseason. The reef was a big hexagon, so you
may have to get creative with how you model obstacles to get a satisfactory
result.</p>
<p>It's also important that the obstacles be modified from year to year. Don't
assume that copying the file verbatim from last year will work, since the robot
will be avoiding last year's obstacles. It's likely there will be a file out
there somewhere in the community (such as from 3173, 6995, or 167), so don't
feel as though you have to be a genius at modelling in order to get a working
solution. All obstacles should be defined as static objects near the
instantiation of last year's obstacles, and the strength of obstacles may need
to be tuned.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.select"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>